{% extends 'job_app/base.html' %}
{% block content %}
  <h3>Payment</h3>
  <p>Complete payment using the card form below (Stripe demo client secret present in context).</p>
  <div id="card-element"></div>
  <button id="pay-btn" class="btn btn-primary mt-3">Pay</button>
{% block scripts %}
<script src="https://js.stripe.com/v3/"></script>
<script>
  const stripe = Stripe("{{ STRIPE_PUBLIC_KEY }}");
  const clientSecret = "{{ client_secret }}";
  const payBtn = document.getElementById('pay-btn');
  payBtn.addEventListener('click', async () => {
    const {error, paymentIntent} = await stripe.confirmCardPayment(clientSecret, {
      payment_method: {card: {}}
    });
    if (error) alert(error.message); else window.location = "{% url 'job_app:payment_success' %}";
  });
</script>
{% endblock %}
{% endblock %}
