{% extends 'job_app/base.html' %}
{% block content %}
<div class="container mt-5">
  <div class="card shadow p-4">
    <h3 class="mb-3 text-center">Book Service</h3>
    <form method="post" id="bookingForm">
      {% csrf_token %}
      
      <div class="mb-3">
        <label for="address" class="form-label">Address</label>
        <input type="text" name="address" id="address" class="form-control" placeholder="Fetching your current location..." required>
      </div>

      <div class="mb-3">
        <label for="date" class="form-label">Booking Date</label>
        <input type="date" name="date" id="date" class="form-control" required>
      </div>

      <button class="btn btn-primary w-100">Confirm Booking</button>
    </form>
  </div>
</div>

<!-- ðŸŒ Auto-fetch user's current location -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const addressInput = document.getElementById("address");

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const lat = pos.coords.latitude;
        const lon = pos.coords.longitude;

        try {
          // ðŸ—ºï¸ Reverse geocode using OpenStreetMap API
          const response = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
          const data = await response.json();

          // ðŸ  Fill address input
          if (data.display_name) {
            addressInput.value = data.display_name;
          } else {
            addressInput.value = `${lat.toFixed(5)}, ${lon.toFixed(5)}`;
          }
        } catch (err) {
          console.error("Location fetch failed:", err);
          addressInput.value = `${lat.toFixed(5)}, ${lon.toFixed(5)}`;
        }
      }, (error) => {
        console.error("Location access denied:", error);
        addressInput.placeholder = "Please enter your address manually";
      });
    } else {
      addressInput.placeholder = "Geolocation not supported by your browser.";
    }
  });
</script>
{% endblock %}
