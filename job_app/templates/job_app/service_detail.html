{% extends 'job_app/base.html' %}
{% block content %}

<div class="container py-4">

  <div class="row g-4 align-items-start">

    <!-- SERVICE IMAGE -->
    <div class="col-md-6 text-center">
      {% if service.image %}
        <img src="{{ service.image.url }}" class="img-fluid rounded shadow-sm" style="max-height: 350px; object-fit: cover;">
      {% else %}
        <img src="https://via.placeholder.com/500x350?text=No+Image" class="img-fluid rounded shadow-sm">
      {% endif %}
    </div>

    <!-- SERVICE DETAILS -->
    <div class="col-md-6">

      <h2 class="fw-bold">{{ service.title }}</h2>

      <p class="text-muted mb-1">
        {{ service.get_category_display }} • Provided by <strong>{{ service.provider.user.username }}</strong>
      </p>

      <hr>

      <p class="mb-3">{{ service.description }}</p>

      <p class="h4 text-success fw-bold mb-4">₹{{ service.hourly_rate }} <span class="text-muted fs-6">/ hour</span></p>

      <!-- ACTION BUTTONS -->
      <div class="d-flex flex-wrap gap-2">

        {% if user.is_authenticated %}
  <a href="{% url 'job_app:create_payment' service.id %}" class="btn btn-primary px-4">Book & Pay</a>
{% else %}
  <a href="{% url 'job_app:login' %}" class="btn btn-primary px-4">Login to Book</a>
{% endif %}

        <!-- WhatsApp -->
        <a href="https://wa.me/{{ service.provider.phone }}?text=Hello%2C%20I%20am%20interested%20in%20your%20service%20{{ service.title }}"
           target="_blank"
           class="btn btn-outline-success">
           <i class="bi bi-whatsapp"></i> WhatsApp
        </a>

        <!-- Call -->
        <a href="tel:{{ service.provider.phone }}" class="btn btn-outline-dark">
          <i class="bi bi-telephone"></i> Call
        </a>

      </div>

      <hr>

      <!-- PROVIDER INFO CARD -->
      <div class="p-3 rounded border bg-light shadow-sm mt-3">
        <h6 class="fw-bold mb-1">Service Provider</h6>
        <p class="mb-1"><strong>Name:</strong> {{ service.provider.user.get_full_name|default:service.provider.user.username }}</p>
        <p class="mb-1"><strong>Phone:</strong> {{ service.provider.phone }}</p>
        {% if service.provider.location %}
<p><i class="bi bi-geo"></i> {{ service.provider.location }}</p>
{% endif %}
      </div>

    </div>
  </div>
  <hr>
<h5 class="mt-4">⭐ Reviews ({{ service.total_reviews }})</h5>
<p class="text-muted">
  Average Rating: 
  <strong>{{ service.average_rating }}</strong> / 5
  <span class="text-warning">
    {% for i in "12345"|slice:":5" %}
      {% if i|add:'0' <= service.average_rating %}★{% else %}☆{% endif %}
    {% endfor %}
  </span>
</p>

<!-- Review Form -->
{% if user.is_authenticated %}
  <form method="post" class="mt-3">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Submit Review</button>
  </form>
{% else %}
  <p class="text-muted mt-3">
    <a href="{% url 'job_app:login' %}">Login</a> to write a review.
  </p>
{% endif %}

<!-- Display Reviews -->
{% if reviews %}
  <ul class="list-group mt-4">
    {% for review in reviews %}
      <li class="list-group-item">
        <strong>{{ review.reviewer.username }}</strong>
        <span class="text-warning">{{ review.stars }}</span>
        <br>
        <small class="text-muted">{{ review.created_at|date:"M d, Y" }}</small>
        <p class="mb-0">{{ review.comment }}</p>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="text-muted mt-3">No reviews yet.</p>
{% endif %}


</div>

{% endblock %}

